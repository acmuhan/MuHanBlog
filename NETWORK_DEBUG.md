# 网络调试工具使用指南

## 🔧 工具概述

网络调试工具是专门为检查生产环境网络策略和外部HTTP服务访问能力而创建的调试页面。

## 📍 访问地址

- **本地开发**: `http://localhost:4323/debug/network`
- **生产环境**: `https://blog.muhan.wiki/debug/network`

## 🛠️ 功能特性

### 1. 环境信息检测
- 当前域名和协议
- 用户代理信息
- 时间戳记录

### 2. 网络连通性测试
- **本地API测试**: 验证内部API响应
- **公共API测试**: 测试HTTPS外部API访问能力
- **音乐API测试**: 直接测试HTTP和HTTPS音乐端点

### 3. 音乐API专项测试
- 测试多个音乐API端点
- 检查HTTP/HTTPS连通性
- 分析响应数据格式

### 4. 代理API测试
- 测试音乐代理API功能
- 验证网络测试API响应
- 检查代理机制是否正常

### 5. 详细日志记录
- 实时日志显示
- 错误信息追踪
- 性能指标记录

## 🚀 使用方法

### 基本测试流程

1. **访问调试页面**
   ```
   https://blog.muhan.wiki/debug/network
   ```

2. **查看环境信息**
   - 页面会自动显示当前环境的基本信息

3. **执行网络连通性测试**
   - 点击"开始测试"按钮
   - 观察各项测试结果

4. **专项测试**
   - 点击"测试音乐API"进行音乐服务测试
   - 点击"测试代理API"验证代理功能

5. **查看详细日志**
   - 在"详细日志"区域查看完整的测试过程
   - 分析错误信息和性能数据

### 测试结果解读

#### ✅ 成功状态
- 绿色背景，显示✅图标
- 包含响应时间和状态码
- 显示部分响应数据

#### ❌ 错误状态
- 红色背景，显示❌图标
- 包含错误信息和错误类型
- 显示详细的错误堆栈

#### ⚠️ 警告状态
- 黄色背景，显示⚠️图标
- 表示部分功能可用但存在问题

## 🔍 常见问题诊断

### 1. CORS错误
```
Access to fetch at '...' has been blocked by CORS policy
```
**原因**: 跨域请求被浏览器阻止
**解决**: 需要服务器端配置CORS头或使用代理

### 2. 混合内容错误
```
Mixed Content: The page at 'https://...' was loaded over HTTPS, but requested an insecure resource 'http://...'
```
**原因**: HTTPS页面请求HTTP资源被阻止
**解决**: 使用HTTPS端点或配置代理

### 3. 连接超时
```
net::ERR_CONNECTION_TIMED_OUT
```
**原因**: 网络连接超时或服务器不可达
**解决**: 检查网络策略和服务器状态

### 4. 连接重置
```
net::ERR_CONNECTION_RESET
```
**原因**: 服务器主动关闭连接
**解决**: 检查服务器配置和网络策略

## 📊 测试报告示例

### 成功的测试结果
```json
{
  "success": true,
  "test": "proxy",
  "results": [
    {
      "endpoint": "http://111.170.19.241:8002",
      "success": true,
      "status": 200,
      "duration": 245,
      "data": { ... }
    }
  ]
}
```

### 失败的测试结果
```json
{
  "success": false,
  "error": "net::ERR_CONNECTION_RESET",
  "endpoint": "https://111.170.19.241:8002"
}
```

## 🛡️ 安全注意事项

1. **生产环境使用**: 调试工具包含敏感信息，建议仅在需要时使用
2. **日志清理**: 测试完成后及时清除日志
3. **访问控制**: 考虑为调试页面添加访问限制

## 🔧 技术实现

### 前端技术
- **Astro**: 静态页面生成
- **TypeScript**: 类型安全的JavaScript
- **Tailwind CSS**: 样式框架

### 后端API
- **Astro API Routes**: 服务端API实现
- **Fetch API**: 网络请求处理
- **错误处理**: 完善的异常捕获机制

### 测试策略
- **多端点测试**: 同时测试HTTP和HTTPS
- **超时控制**: 防止长时间等待
- **错误分类**: 详细的错误类型识别

## 📝 更新日志

### v1.0.0 (2025-01-14)
- ✨ 初始版本发布
- 🔧 基础网络连通性测试
- 🎵 音乐API专项测试
- 🔄 代理API功能测试
- 📝 详细日志记录

## 🤝 贡献指南

如果您发现问题或有改进建议，请：

1. 在调试页面中记录详细的错误信息
2. 复制相关的日志内容
3. 描述您的测试环境和预期结果
4. 提交问题报告或改进建议

---

**注意**: 此工具仅用于调试目的，不应在生产环境中长期保留。

